(()=>{"use strict";class e{constructor({link:e,name:t},s,n){this._cardSelector=s,this._link=e,this._name=t,this._handleCardClick=n}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}_setEventListeners(){this._element.querySelector(".element__image").addEventListener("click",(()=>{this._handleCardClick({link:this._link,name:this._name})})),this._element.querySelector(".element__trash-button").addEventListener("click",this._deleteCard),this._element.querySelector(".element__like-button").addEventListener("click",this._toggleLike)}_deleteCard(e){e.target.closest(".element").remove()}_toggleLike(e){e.target.classList.toggle("element__like-button_active")}createCard(){this._element=this._getTemplate();const e=this._element.querySelector(".element__image");return e.src=this._link,e.alt=this._name,this._element.querySelector(".element__title").textContent=this._name,this._setEventListeners(),this._element}}class t{constructor(e){this._popupElement=e,this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose)}setEventListeners(e){this._popupElement.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__close-button"))&&this.close()}))}_handleEscClose(e){"Escape"===e.key&&this.close()}}class s extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._popupForm=this._popupElement.querySelector(".popup__form"),this._inputList=Array.from(this._popupElement.querySelectorAll(".popup__input"))}setEventListeners(){this._popupElement.querySelector(".popup__form").addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()})),super.setEventListeners()}close(){this._popupForm.reset(),super.close()}_getInputValues(){const e={};return this._inputList.forEach((t=>e[t.name]=t.value)),e}}class n{constructor(e,t){this._formSelector=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._inputList=Array.from(this._formSelector.querySelectorAll(this._inputSelector)),this._buttonElement=this._formSelector.querySelector(this._submitButtonSelector)}_showInputError=(e,t)=>{e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)};_hideInputError=(e,t)=>{e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""};_checkInputValidity=e=>{const t=this._formSelector.querySelector(`#${e.id}-error`);e.validity.valid?this._hideInputError(e,t):this._showInputError(e,t)};_hasInvalidInput=()=>this._inputList.some((e=>!e.validity.valid));_hasNotInputValues=()=>this._inputList.every((e=>0===e.value.length));_disableSubmitButton=()=>{this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0};_enableSubmitButton=()=>{this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1};_toggleButtonState=()=>{this._hasInvalidInput()||this._hasNotInputValues()?this._disableSubmitButton():this._enableSubmitButton()};_setEventListeners=()=>{this._formSelector.addEventListener("submit",(e=>{e.preventDefault()})),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))};enableValidation=()=>{this._setEventListeners(),this._toggleButtonState()};resetValidation=()=>{this._toggleButtonState(),this._inputList.forEach((e=>{const t=this._formSelector.querySelector(`#${e.id}-error`);this._hideInputError(e,t)}))}}const r=document.querySelector("#popup-add-card"),i=r.querySelector("#add-card"),o=document.querySelector("#popup-profile"),l=o.querySelector("#user-name"),a=o.querySelector("#user-job"),u=o.querySelector("#profile-edit"),p=document.querySelector(".popup_type_large-image"),c=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),d=[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],h={inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},m=new n(h,u);m.enableValidation();const v=new n(h,i);v.enableValidation();const E=new class extends t{constructor(e){super(e),this._popupCardImage=this._popupElement.querySelector(".popup__large-image"),this._captionImage=this._popupElement.querySelector(".popup__subtitle")}open({link:e,name:t}){this._popupCardImage.src=e,this._popupCardImage.alt=t,this._captionImage.textContent=t,super.open()}}(p);E.setEventListeners();const S=new s(r,(e=>{C.addItem(L(e))}));S.setEventListeners(),_.addEventListener("click",(()=>{S.open(),v.resetValidation()}));const b=new class{constructor(e){this._userName=document.querySelector(e.userName),this._userJob=document.querySelector(e.userJob)}getUserInfo(){return{userName:this._userName.textContent,userJob:this._userJob.textContent}}setUserInfo(e){this._userName.textContent=e["user-name"],this._userJob.textContent=e["user-job"]}}({userName:".profile__title",userJob:".profile__subtitle"}),y=new s(o,(e=>{b.setUserInfo(e)}));y.setEventListeners(),c.addEventListener("click",(()=>{y.open();const e=b.getUserInfo();l.value=e.userName,a.value=e.userJob,m.resetValidation()}));const g=({link:e,name:t})=>{E.open({link:e,name:t})},L=t=>new e(t,"#card-template",g).createCard(),C=new class{constructor({items:e,renderer:t},s){this._initialItems=e,this._renderer=t,this._container=document.querySelector(s)}renderItems(){this._initialItems.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:d,renderer:L},".elements");d.forEach((e=>{C.addItem(L(e))})),C.renderItems()})();